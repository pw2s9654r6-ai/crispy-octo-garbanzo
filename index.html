<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Focus Timer">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="format-detection" content="telephone=no">
<meta name="robots" content="noindex, nofollow">
<title>Focus Timer</title>

<style>
:root{
--accent:#8ED9B6;
--accent-light:#CFEFE2;
--bg:#ECECEC;
--text:#222;
--muted:#888;
}

html,body{
margin:0;
padding:0;
height:100%;
overflow:hidden;
font-family:-apple-system,BlinkMacSystemFont;
background:var(--bg);
color:var(--text);
}

/* ÁîªÈù¢ */
.screen{
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
background:var(--bg);
display:none;
padding:20px;
box-sizing:border-box;
}

.active{display:block;}

.center{
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100%;
}

/* „Çø„Ç§„Éû„Éº */
.circle-container{
position:relative;
width:280px;
height:280px;
margin:110px auto 40px auto;
}

.time{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:52px;
font-weight:600;
}

/* „Éú„Çø„É≥ */
button{
border:none;
border-radius:999px;
padding:14px 28px;
font-size:16px;
margin:8px;
cursor:pointer;
}

.primary{
background:var(--accent);
color:#fff;
}

.secondary{
background:#ccc;
color:#333;
}

/* „Çø„Éñ„Éê„Éº */
.tabbar{
position:absolute;
bottom:0;
width:100%;
height:60px;
display:flex;
background:var(--accent-light);
color:#fff;
}

.tabbar div{
flex:1;
display:flex;
align-items:center;
justify-content:center;
font-weight:600;
cursor:pointer;
}

.active-tab{
background:var(--accent);
}

/* Ë®òÈå≤ */
.task{
padding:12px;
border-bottom:1px solid #ddd;
display:flex;
justify-content:space-between;
align-items:center;
}

.complete{
color:var(--muted);
}

input{
padding:12px;
border-radius:12px;
border:1px solid #ccc;
width:80%;
font-size:16px;
margin-bottom:20px;
}

.confetti{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-size:42px;
animation:pop 0.7s ease-out forwards;
}

@keyframes pop{
0%{opacity:1;transform:translate(-50%,-50%) scale(0.5);}
100%{opacity:0;transform:translate(-50%,-50%) scale(1.5);}
}
</style>
</head>

<body>

<!-- „Çø„Ç§„Éà„É´ÁîªÈù¢ -->
<div id="titleScreen" class="screen active center">
<h2>‰ΩúÊ•≠„Çø„Ç§„Éà„É´</h2>
<input id="titleInput" placeholder="„Çø„Ç§„Éà„É´">
<button class="primary" onclick="startPrep()">ÈñãÂßã</button>
</div>

<!-- „Çø„Ç§„Éû„ÉºÁîªÈù¢ -->
<div id="timerScreen" class="screen">
<div class="circle-container">
<canvas id="canvas" width="280" height="280"></canvas>
<div class="time" id="timeDisplay">1:00</div>
</div>
<div id="buttons" style="text-align:center;"></div>
</div>

<!-- Ë®òÈå≤ÁîªÈù¢ -->
<div id="recordScreen" class="screen">
<h2>Ë®òÈå≤</h2>
<div id="recordList"></div>
</div>

<!-- „Ç´„É¨„É≥„ÉÄ„Éº -->
<div id="calendarScreen" class="screen">
<h2>„Ç´„É¨„É≥„ÉÄ„Éº</h2>
<p>ÔºàÊã°Âºµ‰∫àÂÆöÔºâ</p>
</div>

<!-- „Çø„Éñ„Éê„Éº -->
<div class="tabbar">
<div onclick="showScreen('timerScreen')" class="active-tab">„Çø„Ç§„Éû„Éº</div>
<div onclick="showScreen('recordScreen')">Ë®òÈå≤</div>
<div onclick="showScreen('calendarScreen')">„Ç´„É¨„É≥„ÉÄ„Éº</div>
</div>

<script>
let state="prep";
let totalSeconds=0;
let currentTask=null;
let animationId=null;
let startTimestamp=null;
const prepDuration=60;

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function drawCircle(progress){
ctx.clearRect(0,0,280,280);

ctx.lineWidth=12;
ctx.strokeStyle="#ddd";
ctx.beginPath();
ctx.arc(140,140,110,0,Math.PI*2);
ctx.stroke();

ctx.strokeStyle=getComputedStyle(document.documentElement)
.getPropertyValue('--accent');

ctx.beginPath();
ctx.arc(140,140,110,-Math.PI/2,(Math.PI*2*progress)-Math.PI/2);
ctx.stroke();
}

function updateDisplay(){
let min=Math.floor(totalSeconds/60);
let sec=totalSeconds%60;
document.getElementById("timeDisplay").innerText=
`${min}:${sec.toString().padStart(2,"0")}`;
}

function startPrep(){
const title=document.getElementById("titleInput").value.trim();
if(!title)return;

currentTask={
title:title,
status:"active",
seconds:0,
date:new Date().toISOString()
};

totalSeconds=0;
state="prep";

showScreen("timerScreen");
renderButtons();
startTimestamp=performance.now();
animationLoop();
}

function animationLoop(){
const now=performance.now();
const elapsed=(now-startTimestamp)/1000;

totalSeconds=Math.floor(elapsed);
currentTask.seconds=totalSeconds;

updateDisplay();

if(state==="prep"){
let progress=Math.min(elapsed/prepDuration,1);
drawCircle(progress);

if(elapsed>=prepDuration){
state="choice";
beep();
renderButtons();
return;
}
}

if(state==="work"){
drawCircle(1);
}

animationId=requestAnimationFrame(animationLoop);
}

function continueTask(){
state="work";
startTimestamp=performance.now()-totalSeconds*1000;
renderButtons();
animationLoop();
}

function endTask(){
cancelAnimationFrame(animationId);
currentTask.status="incomplete";
saveTask();
reset();
}

function completeTask(){
cancelAnimationFrame(animationId);
currentTask.status="complete";
saveTask();
showConfetti();
reset();
}

function renderButtons(){
let c=document.getElementById("buttons");
c.innerHTML="";
if(state==="prep"){
c.innerHTML=`<button class="secondary" onclick="endTask()">ÁµÇ‰∫Ü</button>`;
}
else if(state==="choice"){
c.innerHTML=
`<button class="primary" onclick="continueTask()">Á∂öË°å</button>
<button class="secondary" onclick="endTask()">ÁµÇ‰∫Ü</button>`;
}
else if(state==="work"){
c.innerHTML=
`<button class="primary" onclick="completeTask()">ÂÆå‰∫Ü</button>
<button class="secondary" onclick="endTask()">ÁµÇ‰∫Ü</button>`;
}
}

function saveTask(){
let tasks=JSON.parse(localStorage.getItem("tasks")||"[]");
tasks.unshift(currentTask);
localStorage.setItem("tasks",JSON.stringify(tasks));
}

function renderRecords(){
let tasks=JSON.parse(localStorage.getItem("tasks")||"[]");
let list=document.getElementById("recordList");
list.innerHTML="";

tasks.sort((a,b)=>{
if(a.status==="incomplete" && b.status==="complete")return -1;
if(a.status==="complete" && b.status==="incomplete")return 1;
return 0;
});

tasks.forEach((t,i)=>{
let div=document.createElement("div");
div.className="task "+(t.status==="complete"?"complete":"");
div.innerHTML=
`${t.title} - ${Math.floor(t.seconds/60)}ÂàÜ
<button onclick="deleteTask(${i})">ÂâäÈô§</button>`;
list.appendChild(div);
});
}

function deleteTask(i){
let tasks=JSON.parse(localStorage.getItem("tasks")||"[]");
tasks.splice(i,1);
localStorage.setItem("tasks",JSON.stringify(tasks));
renderRecords();
}

function showScreen(id){
document.querySelectorAll(".screen")
.forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");

document.querySelectorAll(".tabbar div")
.forEach(t=>t.classList.remove("active-tab"));

if(id==="timerScreen")
document.querySelectorAll(".tabbar div")[0].classList.add("active-tab");
if(id==="recordScreen")
document.querySelectorAll(".tabbar div")[1].classList.add("active-tab");
if(id==="calendarScreen")
document.querySelectorAll(".tabbar div")[2].classList.add("active-tab");

if(id==="recordScreen")renderRecords();
}

function reset(){
showScreen("titleScreen");
document.getElementById("titleInput").value="";
}

function showConfetti(){
let div=document.createElement("div");
div.className="confetti";
div.innerText="üéâ";
document.body.appendChild(div);
setTimeout(()=>div.remove(),700);
}

function beep(){
let audioCtx=new (window.AudioContext||window.webkitAudioContext)();
for(let i=0;i<4;i++){
let osc=audioCtx.createOscillator();
osc.connect(audioCtx.destination);
osc.start(audioCtx.currentTime+i*0.25);
osc.stop(audioCtx.currentTime+i*0.25+0.15);
}
}

drawCircle(0);
updateDisplay();
</script>

</body>
</html>
